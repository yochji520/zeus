<!DOCTYPE html>
<html lang="en">
 <head></head>
 <body>
   {% include 'head.html' %}
   {% include 'nav.html' %}
  <div class="main-container" id="main-container">
   <script type="text/javascript">
				try{ace.settings.check('main-containeselected="selected"r' , 'fixed')}catch(e){}
			</script>
   <div class="main-container-inner">
    <a class="menu-toggler" id="menu-toggler" href="#"> <span class="menu-text"></span> </a>
    <div class="sidebar" id="sidebar">
     <script type="text/javascript">
						try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
					</script>
     <!--导航-->
     <ul class="nav nav-list">
      <li class="active"> <a href=" /"> <i class="icon-dashboard"></i> <span class="menu-text"> 仪表盘 </span> </a> </li>
      <li class="active open"> <a href="#" class="dropdown-toggle"> <i class="icon-edit"> </i> <span class="menu-text"> 服务 </span> <b class="arrow icon-angle-down"> </b> </a>
       <ul class="submenu">
        <li class="active"> <a href="/servermanage/servermanage/"> <i class="icon-double-angle-right"> </i> 服务注册 </a> </li>
        <li class="active"> <a href="/servermanage/serverlist/"> <i class="icon-double-angle-right"> </i> 服务列表 </a> </li>
       </ul> </li>
      <li class="active open"> <a href="#" class="dropdown-toggle"> <i class="icon-edit"> </i> <span class="menu-text"> 脚本管理 </span> <b class="arrow icon-angle-down"> </b> </a>
       <ul class="submenu">
        <li class="active"> <a href="/scriptmanage/scriptmanage/"> <i class="icon-double-angle-right"> </i> 添加脚本 </a> </li>
        <li class="active"> <a href="/scriptmanage/scriptlist/"> <i class="icon-double-angle-right"> </i> 脚本列表 </a> </li>
       </ul> </li>
     </ul>
     <div class="sidebar-collapse" id="sidebar-collapse">
      <i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
     </div>
     <script type="text/javascript">
						try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
					</script>
    </div>
    <div class="main-content">
     <div class="breadcrumbs" id="breadcrumbs">
      <script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>
      <ul class="breadcrumb">
       <li> <i class="icon-home home-icon"></i> <a href="#">服务</a> </li>
       <li> <a href="#">服务列表</a> </li>
      </ul>
     </div>
     <div class="page-content">
      <div class="page-header"></div>
      <div class="row">
       <div class="col-xs-12">
        <div class="row">
         <div class="col-xs-12">
          <div class="modal-footer no-margin-top">
            SERVER_TYPE：
           <input /> &nbsp;&nbsp;&nbsp;&nbsp;
           <input type="button" value="Search" href="/" />
          </div>
          <div class="table-responsive">
           <table id="sample-table-2" class="table table-striped table-bordered table-hover">
            <thead>
             <tr>
              <th>服务ID</th>
              <th>地址</th>
              <th>端口</th>
              <th>服务类型</th>
              <th>角色类型</th>
              <th>环境类型</th>
              <th>基础操作</th>
             </tr>
            </thead>
            <tbody>
            {% for serverlist in reulstlist %}
             <tr>
              <td>{{ serverlist.server_id }}</td>
              <td>{{ serverlist.host }}</td>
              <td>{{ serverlist.port }}</td>
              <td>{{ serverlist.server_type }}</td>
              <td>{{ serverlist.role_type }}</td>
              <td>{{ serverlist.env_type }}</td>
              <td class="hidden-320">
                  <button type="button" class="icon-zoom-in blue " data-toggle="modal" onclick="return select_info(server_id)" data-target="#addUserModal">&nbsp;查看</button>
                  &nbsp;&nbsp;
                  <button type="button" class="icon-edit green" data-toggle="modal" onclick="return get_edit_info(server_id)" data-target="#addUserModal">&nbsp;编辑</button>
                  &nbsp;&nbsp;
                  <button type="button" class="icon-trash red" onclick="return delete_info(server_id)">&nbsp;删除</button> </td>
             </tr>
            {% endfor %}
            </tbody>
           </table>
           <form method="post" action="" class="form-horizontal" role="form" id="form_data" onsubmit="return check_form()" style="margin: 20px;">
            <div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
             <div class="modal-dialog">
              <div class="modal-content">
               <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
                <h4 class="modal-title" id="myModalLabel"> 用户信息 </h4>
               </div>
               <div class="modal-body">
                <div class="form-group">
                 <label for="user_id" class="col-sm-3 control-label">用户ID</label>
                 <div class="col-sm-9">
                  <input type="text" class="form-control" id="user_id" name="user_id" value="{user_id}" placeholder="请输入用户ID" />
                 </div>
                </div>
                <div class="form-group">
                 <label for="lastname" class="col-sm-3 control-label">用户名</label>
                 <div class="col-sm-9">
                  <input type="text" class="form-control" name="user_name" value="" id="user_name" placeholder="用户名" />
                 </div>
                </div>
                <div class="form-group">
                 <label for="lastname" class="col-sm-3 control-label">地址</label>
                 <div class="col-sm-9">
                  <input type="text" class="form-control" name="address" value="" id="address" placeholder="地址" />
                 </div>
                </div>
                <div class="form-group">
                 <label for="remark" class="col-sm-3 control-label">备注</label>
                 <div class="col-sm-9">
                  <textarea class="form-control" name="remark" value="{remark}" id="remark" placeholder="备注"> </textarea>
                 </div>
                </div>
               </div>
               <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭 </button>
                <button type="submit" class="btn btn-primary"> 提交 </button>
                <span id="tip"> </span>
               </div>
              </div>
              <!-- /.modal-content -->
             </div>
             <!-- /.modal -->
            </div>
           </form>
          </div>
         </div>
         <div class="modal-footer no-margin-top">
         <ul class="pagination pull-right no-margin">
          <li class="prev disabled"> <a href="#"> <i class="icon-double-angle-left"></i> </a> </li>
          <li> <a href="#">1</a> </li>
          <li> <a href="#">2</a> </li>
          <li> <a href="">3</a> </li>
          <li class="next"> <a href="#"> <i class="icon-double-angle-right"></i> </a> </li>
         </ul>
        </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <!-- basic scripts -->
  {% include 'static_js.html' %}
    <script>
    // 提交表单
    function delete_info(id)
    {
        if(!id)
        {
            alert('Error！');
            return false;
        }
        // var form_data = new Array();

        $.ajax(
                {
                    url: "action/user_action.php",
                    data:{"id":id, "act":"del"},
                    type: "post",
                    beforeSend:function()
                    {
                        $("#tip").html("<span style='color:blue'>正在处理...</span>");
                        return true;
                    },
                    success:function(data)
                    {
                        if(data > 0)
                        {
                            alert('操作成功');
                            $("#tip").html("<span style='color:blueviolet'>恭喜，删除成功！</span>");

                            // document.location.href='world_system_notice.php'
                             location.reload();
                        }
                        else
                        {
                            $("#tip").html("<span style='color:red'>失败，请重试</span>");
                            alert('操作失败');
                        }
                    },
                    error:function()
                    {
                        alert('请求出错');
                    },
                    complete:function()
                    {
                        // $('#tips').hide();
                    }
                });

        return false;
    }

    // 编辑表单
    function get_edit_info(server_id)
    {
        if(!server_id)
        {
            alert('Error！');
            return false;
        }
        // var form_data = new Array();

        $.ajax(
                {
                    url: "action/user_action.php",
                    data:{"server_id":server_id, "act":"get"},
                    type: "post",
                    beforeSend:function()
                    {
                        // $("#tip").html("<span style='color:blue'>正在处理...</span>");
                        return true;
                    },
                    success:function(data)
                    {
                        if(data)
                        {

                            // 解析json数据
                            var data = data;

                            var data_obj = eval("("+data+")");

                            // 赋值
                            $("#server_id").val(data_obj.user_id);

                            $("#name").val(data_obj.name);
                            $("#address").val(data_obj.address);
                            $("#remark").val(data_obj.remark);
                            $("#act").val("edit");

                            // 将input元素设置为readonly
                            $('#server_id').attr("readonly","readonly")
                           // location.reload();
                        }
                        else
                        {
                            $("#tip").html("<span style='color:red'>失败，请重试</span>");
                          //  alert('操作失败');
                        }
                    },
                    error:function()
                    {
                        alert('请求出错');
                    },
                    complete:function()
                    {
                        // $('#tips').hide();
                    }
                });

        return false;
    }

    // 提交表单
    function check_form()
    {
        var user_id = $.trim($('#user_id').val());
        var act     = $.trim($('#act').val());

        if(!user_id)
        {
            alert('用户ID不能为空！');
            return false;
        }
           var form_data = $('#form_data').serialize();

        // 异步提交数据到action/add_action.php页面
        $.ajax(
                {
                    url: "action/user_action.php",
                    data:{"form_data":form_data,"act":act},
                    type: "post",
                    beforeSend:function()
                    {
                        $("#tip").html("<span style='color:blue'>正在处理...</span>");
                        return true;
                    },
                    success:function(data)
                    {
                        if(data > 0)
                        {

                            var msg = "添加";
                            if(act == "edit") msg = "编辑";
                            $("#tip").html("<span style='color:blueviolet'>恭喜，" +msg+ "成功！</span>");
                            // document.location.href='system_notice.php'
                            alert(msg + "OK！");
                            location.reload();
                        }
                        else
                        {
                            $("#tip").html("<span style='color:red'>失败，请重试</span>");
                            alert('操作失败');
                        }
                    },
                    error:function()
                    {
                        alert('请求出错');
                    },
                    complete:function()
                    {
                        $('#acting_tips').hide();
                    }
                });

        return false;
    }

    $(function () { $('#addUserModal').on('hide.bs.modal', function () {
        // 关闭时清空edit状态为add
        $("#act").val("add");
        location.reload();
    })
    });
</script>

 </body>
</html>